<!DOCTYPE HTML>
<!--
	Striped by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<title>PiKesi's Home on the Internet</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="/assets/css/main.css" />
	<link rel="stylesheet" href="/board/css/board.css" />
	<link rel="stylesheet" href="/board/css/popup.css" />
	<link rel="icon" href="/assets/images/head1.png">
	<style>

	</style>
</head>

<body class="is-preload">
	<script>
		sessionStorage.setItem('token', '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');
	</script>
	<script src="/board/js/token.js"></script>
	<script src="/board/js/getIssue.js"></script>
	<script src="/board/js/pushIssue.js"></script>
	<script src="/board/js/getToken.js"></script>

	<div class="loading-container">
		<div class="loading"></div>
	</div>

	<div class="popup">
		<div class="head">
			<svg t="1681748112100" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
				p-id="2640" width="50" height="50">
				<path
					d="M511.998465 65.290005c-246.722194 0-446.708971 200.001103-446.708971 446.708971 0 246.708891 199.986777 446.709995 446.708971 446.709995 246.708891 0 446.711018-200.001103 446.711018-446.709995C958.709483 265.291109 758.707356 65.290005 511.998465 65.290005L511.998465 65.290005zM756.308727 405.884171 465.103412 697.081299c-6.804986 6.819313-17.856693 6.819313-24.662703 0L267.69025 524.33084c-6.804986-6.804986-6.804986-17.856693 0-24.668843l54.29765-54.290487c6.804986-6.812149 17.856693-6.812149 24.662703 0l106.122993 106.107643 224.574778-224.561475c6.804986-6.812149 17.857716-6.812149 24.663726 0l54.29765 54.290487C763.128039 388.020314 763.128039 399.072021 756.308727 405.884171L756.308727 405.884171 756.308727 405.884171zM756.308727 405.884171"
					fill="#89C27E" p-id="2641"></path>
			</svg>
			<h2>提交成功！</h2>
		</div>

		<p style="color: rgb(34, 19, 19); font-weight: 600;">由衷感谢您对本网站的支持！</p>
		<hr>
		<p>您的留言将在审查被回复后展示在留言板中！</p>
	</div>

	<div class="failed-popup">
		<div class="head">
			<svg t="1681834251858" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
				p-id="2667" width="50" height="50">
				<path
					d="M549.044706 512l166.189176-166.249412a26.383059 26.383059 0 0 0 0-36.98447 26.383059 26.383059 0 0 0-37.044706 0L512 475.015529l-166.249412-166.249411a26.383059 26.383059 0 0 0-36.98447 0 26.383059 26.383059 0 0 0 0 37.044706L475.015529 512l-166.249411 166.249412a26.383059 26.383059 0 0 0 0 36.98447 26.383059 26.383059 0 0 0 37.044706 0L512 548.984471l166.249412 166.249411a26.383059 26.383059 0 0 0 36.98447 0 26.383059 26.383059 0 0 0 0-37.044706L548.984471 512zM512 1024a512 512 0 1 1 0-1024 512 512 0 0 1 0 1024z"
					fill="#E84335" p-id="2668"></path>
			</svg>
			<h2>提交失败</h2>
		</div>

		<p style="color: rgb(34, 19, 19); font-weight: 600;">由衷感谢您对本网站的支持！</p>
		<hr>
		<p>请检查您的网络连接或直接联系@PiKesi</p>
	</div>

	<div class="board-popup">
		<form id="message-form">
			<div class="MSG">
				<h2 style="color: #ba3a3a; font-weight: 800;">创建留言</h2>
			</div>
			<div class="title">
				<label style="display: inline-block; width: 30%;" for="name">您的称呼：</label>
				<input style="display: inline-block; width: 69%;" type="text" id="name" name="name" value="匿名用户"
					required>
			</div>
			<hr style="margin-top: 10px;">
			<div class="message">
				<!-- <label for="message">&nbsp; Message：</label> -->
				<textarea maxlength="1000" id="message" name="message" style="resize: none; height: 150px;"
					placeholder="想对PiKesi说的话... (1000字以内)" required></textarea>
			</div>
			<button class="submit-button" type="submit">发布留言</button>
			<button class="close-button" onclick="closeBoardPopup()">关闭</button>
		</form>
	</div>

	<script>
		const form = document.querySelector('#message-form');

		form.addEventListener('submit', (event) => {
			// 阻止表单默认提交事件
			event.preventDefault();

			// 获取必填字段
			const name = document.querySelector('#name').value.trim();
			const message = document.querySelector('#message').value.trim();

			// 检查必填字段是否已经填写
			if (!name || !message) {
				alert('请填写必填字段！');
				return false;
			}

			// 必填字段已经填写，调用trysubmit函数
			trySubmit(name, message);
		});
	</script>

	<div class="overlay"></div>

	<!-- Content -->
	<div id="content">
		<div class="inner">
			<div class="title">
				<img src="/board/Board_copper.png" alt="Message Board">

				<hr style="margin: 0;">
				<!-- <header>
					<h2>匿名留言板</h2>
				</header> -->
			</div>
			<div class="submit">
				<button onclick="openBoardPopup()">
					<!-- <img src="/board/button.png" style="width: 100%;" alt="button"> -->
					留下一笔
				</button>
			</div>

			<div class="issues">
				<!-- <article class="box post post-excerpt">
					<header>
						<h3>ISSUE TITLE<span>最新回复于 2023-4-15</span></h3>
					</header>
					<hr>
					<div class="ask">
						<img src="/board/S.png" style="width: 30px;" alt="">
						<span style="padding: 0 0.3em; color: #AAA;"> ：</span>
						ASK ME SOMETHING
					</div>
					<hr>
					<div class="answer">
						<img src="/board/P.png" style="width: 30px;" alt="">
						<span style="padding: 0 0.3em; color: #AAA;"> ：</span>
						ASK ME SOMETHING
					</div>
				</article> -->
			</div>
		</div>
	</div>

	<!-- 提交至留言板 -->
	<script>

		function showLoading() {
			const loadingContainer = document.querySelector('.loading-container');
			loadingContainer.style.display = 'flex';
			document.body.style.overflow = 'hidden'; // 防止页面滚动
		}

		function hideLoading() {
			const loadingContainer = document.querySelector('.loading-container');
			loadingContainer.style.display = 'none';
		}
		hideLoading();

		function openPopup() {
			const popup = document.querySelector('.popup');
			popup.classList.add('visible');
			// console.log(popup);
			setTimeout(function () {
				closePopup();
			}, 2000);
		}

		function closePopup() {
			const popup = document.querySelector('.popup');
			popup.classList.remove('visible');
			document.body.style.overflow = ''; // 恢复页面滚动
		}

		function openFailedPopup() {
			const popup = document.querySelector('.failed-popup');
			popup.classList.add('visible');
			setTimeout(function () {
				closeFailedPopup();
			}, 3000);
		}

		function closeFailedPopup() {
			const popup = document.querySelector('.failed-popup');
			popup.classList.remove('visible');
		}

		function openBoardPopup() {
			const popup = document.querySelector('.board-popup');
			const overlay = document.querySelector('.overlay');
			popup.style.opacity = '0';  // 设置为0
			popup.style.pointerEvents = 'auto';
			setTimeout(() => {
				popup.style.display = 'block';
				popup.style.opacity = '1';  // 过渡到1
			}, 10);
			overlay.style.display = 'block';
		}

		function closeBoardPopup() {
			const popup = document.querySelector('.board-popup');
			const overlay = document.querySelector('.overlay');
			popup.style.opacity = '0';  // 过渡到0
			popup.style.pointerEvents = 'none';
			setTimeout(() => {
				popup.style.display = 'none';
			}, 300);  // 在过渡完成后设置为none
			overlay.style.display = 'none';
		}

		function trySubmit(user, content) {
			// console.log("click");
			closeBoardPopup();
			showLoading();

			const successPopup = document.querySelector('.success-popup');
			pushIssue(user, content)
				.then(result => {
					document.querySelector('#message').value = null;
					openPopup();
					console.log(result);
				})
				.catch(error => {
					openFailedPopup();
					console.log(error);
				})
				.finally(() => {
					hideLoading();
				})
		}

	</script>

	<!-- 读取留言板的内容 -->
	<script>
		function addIssueArticle(conversation) {
			// 创建 article 元素
			const article = document.createElement('article');
			article.classList.add('box', 'post', 'post-excerpt');

			// 创建 header 元素
			const header = document.createElement('header');
			const date = document.createElement('span');
			date.textContent = `回复于 ${conversation.replyDate}`; // 替换为最新回复日期
			const title = document.createElement('h3');
			title.textContent = `来自 ${conversation.title} 的留言`; // 替换为 issue 标题
			title.appendChild(date)
			header.appendChild(title);
			// header.appendChild(date);
			article.appendChild(header);

			const hr1 = document.createElement('hr');
			article.appendChild(hr1);

			// 创建 ask 元素
			const ask = document.createElement('div');
			ask.classList.add('ask');
			const askImage = document.createElement('img');
			askImage.classList.add('s');
			askImage.src = '/board/S.png'; // 替换为提问者的图像
			askImage.style.width = '30px';
			ask.appendChild(askImage);
			const askText = document.createElement('span');
			askText.style.padding = '0 0.3em';
			askText.style.color = '#AAA';
			askText.textContent = '：';
			ask.appendChild(askText);
			const askContent = document.createElement('span');
			askContent.textContent = conversation.question; // 替换为问题内容
			ask.appendChild(askContent);
			article.appendChild(ask);

			const hr2 = document.createElement('hr');
			article.appendChild(hr2);

			// 创建 answer 元素
			const answer = document.createElement('div');
			answer.classList.add('answer');
			const answerImage = document.createElement('img');
			answerImage.classList.add('p');
			answerImage.src = '/board/P.png'; // 替换为回答者的图像
			answerImage.style.width = '30px';
			answer.appendChild(answerImage);
			const answerText = document.createElement('span');
			answerText.style.padding = '0 0.3em';
			answerText.style.color = '#AAA';
			answerText.textContent = '：';
			answer.appendChild(answerText);
			const answerContent = document.createElement('span');
			answerContent.textContent = conversation.reply; // 替换为回答内容
			answer.appendChild(answerContent);
			article.appendChild(answer);

			// 获取 #content .inner .issues 元素
			const issues = document.querySelector('#content .inner .issues');

			// 将 article 元素插入 #content .inner .issues 元素中
			issues.appendChild(article);
		}

		fetchAllIssueComments()
			.then(updatedConversations => {
				// addIssueArticle(updatedConversations);
				updatedConversations.forEach(conversation => {
					addIssueArticle(conversation);
				});
				console.log(updatedConversations); // 打印更新后的 conversations
			})
			.catch(error => console.error(error));
	</script>

	<!-- Sidebar -->
	<div id="sidebar">
		<script>
			fetch('/component/sidebar/sidebar.html')
				.then(response => response.text())
				.then(data => {
					// 获取文本字符串中的每一行
					const lines = data.split('\n');
					// 修改第三行
					lines[17] = "        <li class='current'><a href='/pages/board.html'>BBS(测试版)</a></li>\n";
					// 将修改后的文本字符串重新加载到myDiv元素中
					document.getElementById('sidebar').innerHTML = lines.join('');
				});
		</script>
	</div>


	<!-- MusicPlayer -->
	<div id="player">
		<script src="/component/musicPlayer/loadMusicPlayer.js"></script>
	</div>
	
	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>

</body>

</html>